//TODO:This autogenerated class includes the basics for a Registration
//Handler class. You will need to customize it to ensure it meets your needs and
//the data provided by the third party.
global class AutocreatedConfigSelfReg1658390615406 implements Auth.RegistrationHandler{
    
	public String LANGUAGE_LOCAL_KEY = 'fr';
    public String LOCAL_SID_KEY = 'fr_FR';
    public String TIME_ZONE_SIDKEY = 'Europe/Paris';
    public String EMAIL_ENCODING_KEY = 'ISO-8859-1';
   // public static String domain = system.Label.Domain;
    
    public user CheckUserInfo(Auth.UserData data) {
        
        String usernameApi = '%' +data.email  + '%';
        system.debug(usernameApi);
        List<user> usernameList =[SELECT LastName, FirstName, email, profile.name, username FROM user where username like :usernameApi];
        system.debug(usernameList);
        User myUser = null;
        if(usernameList.size() >0){
            myUser = usernameList[0];
            if(myUser.FirstName != data.firstName){
                throw new MyException('First Name not identical'); 
            }else if(myUser.LastName != data.LastName){
                throw new MyException('Last Name not identical'); 
            }else if(myUser.email != data.email){
                throw new MyException('Email not identical'); 
            }else if(myUser.profile.Name != data.attributeMap.get('profilName')){
                throw new MyException('Profile Name not identical'); 
            }
               
        }else
            throw new MyException('User Not Found');
        
        return myUser;
    }
    
    global User createUser(Id portalId, Auth.UserData data){
        system.debug('Inside createUser --> data: ' + data);
        system.debug('attribut map keyset' + data.attributeMap.keyset());
        for(String mydata: data.attributeMap.keyset()){
            system.debug('key: ' + mydata  + ' |Value: ' + data.attributeMap.get(mydata));
        }
        User myUser = CheckUserInfo(data);
        return myUser;
      
    }
    
    global void updateUser(Id userId, Id portalId, Auth.UserData data){
       
         system.debug('data: ' + data);
         system.debug('attribut map keyset' + data.attributeMap.keyset());
            for(String mydata: data.attributeMap.keyset()){
                system.debug('key: ' + mydata  + ' |Value: ' + data.attributeMap.get(mydata));
            }
        User u = CheckUserInfo(data);       
    } 
    
   public class MyException extends Exception{}
}